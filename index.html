<!DOCTYPE html>
<html lang="ta">
<head>
  <meta charset="UTF-8" />
  <title>Meenakshi Finance - ро╡роЯрпНроЯро┐ роХрогроХрпНроХро┐роЯрпБроорпН рокропройрпНрокро╛роЯрпБ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="theme-color" content="#0ea5e9" />

  <!-- iOS PWA meta -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="apple-mobile-web-app-title" content="Meenakshi Finance">
  <link rel="apple-touch-icon" href="./icons/icon-180.png">

  <!-- Manifest -->
  <link rel="manifest" href="./manifest.webmanifest">

  <!-- Bootstrap 5 CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />

  <style>
    body { background: #f5f6fa; }
    .app-card { border-radius: 16px; }
    .app-title { color: #1f2937; }
    .form-label { font-weight: 700; }
    .hint { color:#6b7280; font-size: 0.95rem; }
    .error { color:#b91c1c; font-size: 0.95rem; }
    .section-title { font-weight: 700; }
    .kv { display:flex; justify-content:space-between; padding:.5rem 0; border-bottom:1px dashed #e5e7eb; }
    .kv:last-child { border-bottom:0; }
    .highlight { font-weight:800; }
    .big-number { font-size: clamp(1.35rem, 4.5vw, 1.75rem); }
    .meta-number { font-size: clamp(1rem, 3.5vw, 1.125rem); color:#374151; }
    .form-control { padding: 0.9rem 1rem; font-size: 1.05rem; }
    .btn-lg { padding: 0.9rem 1.1rem; font-weight: 700; }
    .input-group .form-control { border-top-right-radius: 0; border-bottom-right-radius: 0; }
    .input-group .btn-outline-secondary { border-top-left-radius: 0; border-bottom-left-radius: 0; }
    .breakdown { font-size: 1.1rem; font-weight: 700; color:#111; margin-bottom: 6px; }
    .install-card { display:none; }
  </style>
</head>
<body>
  <div class="container my-4">
    <div class="card shadow app-card">
      <div class="card-body p-4">
        <h1 class="h3 text-center app-title mb-2">Meenakshi Finance</h1>
        <h2 class="h5 text-center text-secondary mb-3">ро╡роЯрпНроЯро┐ роХрогроХрпНроХро┐роЯрпБроорпН рокропройрпНрокро╛роЯрпБ</h2>

        <!-- Install buttons / help -->
        <div class="d-grid gap-2 mb-3">
          <button id="btnInstall" class="btn btn-primary btn-lg" style="display:none;">рокропройрпНрокро╛роЯрпНроЯрпИ роиро┐ро▒рпБро╡ (Install App)</button>
        </div>

        <!-- Install help card (shown when prompt doesn't fire or on iOS) -->
        <div id="installHelp" class="card border-info install-card">
          <div class="card-body">
            <div class="h6 mb-2">ЁЯУ▓ роиро┐ро▒рпБро╡рпБроорпН ро╡ро┤ро┐роорпБро▒рпИ</div>
            <ol class="mb-0">
              <li><strong>Android (Chrome):</strong> роЙро▓ро╛ро╡ро┐ропро┐ро▓рпН <em>тЛо</em> роорпЖройрпБ тЖТ <strong>Add to Home screen</strong>.</li>
              <li><strong>iPhone/iPad (Safari):</strong> <em>Share</em> тЖТ <strong>Add to Home Screen</strong>.</li>
            </ol>
            <div class="hint mt-2">роХро╡ройроорпН: GitHub, Facebook, Instagram рокрпЛройрпНро▒ in-app browsers-ро▓рпН роиро┐ро▒рпБро╡ро▓рпН роХро╛рогрокрпНрокроЯро╛родрпБ. Chrome/Safari-ропро┐ро▓рпН родро┐ро▒роХрпНроХро╡рпБроорпН.</div>
          </div>
        </div>

        <!-- Amount -->
        <div class="mb-3 mt-3">
          <label for="amount" class="form-label">родрпКроХрпИ</label>
          <input id="amount" type="number" inputmode="decimal" class="form-control form-control-lg" placeholder="роЙродро╛: 43000">
          <div id="errAmount" class="error mt-1"></div>
        </div>

        <!-- Fixed rate -->
        <div class="mb-3">
          <label for="rate" class="form-label">ро╡роЯрпНроЯро┐ ро╡ро┐роХро┐родроорпН (%)</label>
          <input id="rate" type="number" class="form-control form-control-lg" value="1.25" readonly>
          <div class="hint mt-1">ро╡ро┐роХро┐родроорпН роОрокрпНрокрпЛродрпБроорпН 1.25% (рооро╛родро╛роирпНродро┐ро░ роЕроЯро┐рокрпНрокроЯрпИ)</div>
        </div>

        <!-- Start date with auto-slash DD/MM/YYYY and native calendar -->
        <div class="mb-3">
          <label for="startDateText" class="form-label">роЕроЯроХрпБ рокро┐роЯро┐рокрпНрокрпБ родрпЗродро┐</label>
          <div class="input-group">
            <input id="startDateText" type="text" inputmode="numeric" class="form-control form-control-lg"
                   placeholder="DD/MM/YYYY" maxlength="10" autocomplete="off">
            <button class="btn btn-outline-secondary" type="button" id="openCalendar">ЁЯУЕ</button>
          </div>
          <div class="hint mt-1">родрпЗродро┐ ро╡роЯро┐ро╡роорпН: DD/MM/YYYY (роЙродро╛: 05/08/2025)</div>
          <div id="errStart" class="error mt-1"></div>
          <input id="startDateNative" type="date" class="visually-hidden" />
        </div>

        <!-- Today -->
        <div class="mb-3">
          <label for="today" class="form-label">роЗройрпНро▒рпБ</label>
          <input id="today" type="date" class="form-control form-control-lg" readonly>
        </div>

        <!-- Auto days -->
        <div class="mb-4">
          <label class="form-label">роиро╛роЯрпНроХро│рпН (родро╛ройро╛роХ роХрогроХрпНроХро┐роЯрокрпНрокроЯрпНроЯродрпБ)</label>
          <input id="autoDays" type="number" class="form-control form-control-lg" readonly>
          <div id="durationLine" class="breakdown"></div>
        </div>

        <!-- Results -->
        <div id="results" class="card border-0 bg-light-subtle" style="display:none;">
          <div class="card-body">
            <div class="kv"><div>роорпБродро▓рпНродрпКроХрпИ</div><div id="outPrincipal" class="meta-number">тАФ</div></div>
            <div class="kv"><div>ро╡роЯрпНроЯро┐ ро╡ро┐роХро┐родроорпН</div><div id="outRate" class="meta-number">тАФ</div></div>
            <div class="kv"><div>роорпКродрпНрод роиро╛роЯрпНроХро│рпН</div><div id="outDays" class="meta-number">тАФ</div></div>

            <div class="card mt-3">
              <div class="card-body">
                <div class="section-title mb-1">родро┐ройроЪро░ро┐ (Daily)</div>
                <div id="dyBreakdown" class="breakdown">тАФ</div>
                <div class="kv"><div>роорпКродрпНрод ро╡роЯрпНроЯро┐</div><div id="dyInterest" class="big-number highlight">тАФ</div></div>
                <div class="kv"><div class="text-secondary">роорпКродрпНродроорпН (роорпБродро▓рпНродрпКроХрпИ + ро╡роЯрпНроЯро┐)</div><div id="dyTotal" class="meta-number">тАФ</div></div>
              </div>
            </div>

            <div class="card mt-3">
              <div class="card-body">
                <div class="section-title mb-1">рооро╛родро╛роирпНродро┐ро░ (30 роиро╛роЯрпНроХро│рпН/рооро╛родроорпН)</div>
                <div id="moBreakdown" class="breakdown">тАФ</div>
                <div class="kv"><div>роорпКродрпНрод ро╡роЯрпНроЯро┐</div><div id="moInterest" class="big-number highlight">тАФ</div></div>
                <div class="kv"><div class="text-secondary">роорпКродрпНродроорпН (роорпБродро▓рпНродрпКроХрпИ + ро╡роЯрпНроЯро┐)</div><div id="moTotal" class="meta-number">тАФ</div></div>
              </div>
            </div>

            <div class="card mt-3">
              <div class="card-body">
                <div class="section-title mb-1">ро╡ро░рпБроЯро╛роирпНродро┐ро░ (365 роиро╛роЯрпНроХро│рпН/ро╡ро░рпБроЯроорпН)</div>
                <div id="yrBreakdown" class="breakdown">тАФ</div>
                <div class="kv"><div>роорпКродрпНрод ро╡роЯрпНроЯро┐</div><div id="yrInterest" class="big-number highlight">тАФ</div></div>
                <div class="kv"><div class="text-secondary">роорпКродрпНродроорпН (роорпБродро▓рпНродрпКроХрпИ + ро╡роЯрпНроЯро┐)</div><div id="yrTotal" class="meta-number">тАФ</div></div>
              </div>
            </div>

          </div>
        </div>

        <div class="d-grid mt-3">
          <button id="btnReset" type="button" class="btn btn-outline-secondary btn-lg">роорпАроЯрпНроЯроорпИ</button>
        </div>

      </div>
    </div>
  </div>

  <script>
    // ---- PWA install logic with fallback help card ----
    let deferredPrompt = null;
    const installBtn = document.getElementById('btnInstall');
    const installHelp = document.getElementById('installHelp');

    function isInStandalone() {
      return (window.matchMedia && window.matchMedia('(display-mode: standalone)').matches)
             || window.navigator.standalone === true;
    }
    function isIos() {
      return /iphone|ipad|ipod/i.test(navigator.userAgent);
    }
    function isInAppBrowser() {
      const ua = navigator.userAgent.toLowerCase();
      return ua.includes('fbav') || ua.includes('instagram') || ua.includes('twitter') || ua.includes('linkedin') || ua.includes('pinterest');
    }

    // Show help if:
    // - iOS (no beforeinstallprompt), OR
    // - No prompt fired after a short delay, OR
    // - Opened in in-app browser
    function maybeShowHelp() {
      if (isInStandalone()) return; // Already installed
      if (isIos() || isInAppBrowser()) { installHelp.style.display = 'block'; return; }
      // If no prompt after 3s, show help
      setTimeout(()=>{ if (!deferredPrompt) installHelp.style.display = 'block'; }, 3000);
    }

    window.addEventListener('beforeinstallprompt', (e) => {
      e.preventDefault();
      deferredPrompt = e;
      installBtn.style.display = 'block';
    });

    installBtn && installBtn.addEventListener('click', async () => {
      if (!deferredPrompt) return;
      deferredPrompt.prompt();
      await deferredPrompt.userChoice;
      deferredPrompt = null;
      installBtn.style.display = 'none';
    });

    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('./sw.js').finally(maybeShowHelp);
      });
    } else {
      maybeShowHelp();
    }

    // ---- App logic (unchanged) ----
    function formatINR(v){ return new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR"}).format(v); }
    function r2(x){ return Math.round((x + Number.EPSILON) * 100) / 100; }
    function pad2(n){ return String(n).padStart(2,'0'); }
    function toISOFromDate(d){ return `${d.getFullYear()}-${pad2(d.getMonth()+1)}-${pad2(d.getDate())}`; }
    function diffDays(start, end){
      const sUTC = Date.UTC(start.getFullYear(), start.getMonth(), start.getDate());
      const eUTC = Date.UTC(end.getFullYear(), end.getMonth(), end.getDate());
      return Math.floor((eUTC - sUTC) / (1000*60*60*24));
    }
    function parseDMY(str){
      if(!/^\d{2}\/\d{2}\/\d{4}$/.test(str)) return null;
      const [dd,mm,yyyy] = str.split('/').map(Number);
      const d = new Date(yyyy, mm-1, dd);
      return (d.getFullYear()===yyyy && d.getMonth()+1===mm && d.getDate()===dd) ? d : null;
    }
    function autoFormatDMY(input){
      let v = input.value.replace(/[^\d]/g,'').slice(0,8);
      if(v.length >= 5) v = v.slice(0,2)+'/'+v.slice(2,4)+'/'+v.slice(4);
      else if(v.length >= 3) v = v.slice(0,2)+'/'+v.slice(2);
      input.value = v;
    }
    function breakdownMonths(days){ return {m:Math.floor(days/30), d:days%30}; }
    function breakdownYears(days){
      const y = Math.floor(days/365);
      const rem = days % 365;
      return { y, m: Math.floor(rem/30), d: rem % 30 };
    }
    function humanMD(days){ const {m,d}=breakdownMonths(days); return m>0 ? (d>0?`${m} рооро╛родроорпН ${d} роиро╛ро│рпН`:`${m} рооро╛родроорпН`) : `${d} роиро╛ро│рпН`; }
    function humanYMD(days){ const {y,m,d}=breakdownYears(days); return `${y} ро╡ро░рпБроЯроорпН ${m} рооро╛родроорпН ${d} роиро╛ро│рпН`; }

    const els = {
      amount: document.getElementById('amount'),
      rate: document.getElementById('rate'),
      startDateText: document.getElementById('startDateText'),
      startDateNative: document.getElementById('startDateNative'),
      openCalendar: document.getElementById('openCalendar'),
      today: document.getElementById('today'),
      autoDays: document.getElementById('autoDays'),
      errAmount: document.getElementById('errAmount'),
      errStart: document.getElementById('errStart'),
      results: document.getElementById('results'),
      outPrincipal: document.getElementById('outPrincipal'),
      outRate: document.getElementById('outRate'),
      outDays: document.getElementById('outDays'),
      dyBreakdown: document.getElementById('dyBreakdown'),
      moBreakdown: document.getElementById('moBreakdown'),
      yrBreakdown: document.getElementById('yrBreakdown'),
      dyInterest: document.getElementById('dyInterest'),
      dyTotal: document.getElementById('dyTotal'),
      moInterest: document.getElementById('moInterest'),
      moTotal: document.getElementById('moTotal'),
      yrInterest: document.getElementById('yrInterest'),
      yrTotal: document.getElementById('yrTotal'),
      btnReset: document.getElementById('btnReset'),
      durationLine: document.getElementById('durationLine'),
    };

    function setTodayAndMax(){
      const now = new Date();
      const iso = toISOFromDate(now);
      els.today.value = iso;
      els.startDateNative.max = iso;
    }
    function syncFromNativeToText(){
      const v = els.startDateNative.value; if(!v) return;
      const [yyyy,mm,dd] = v.split('-');
      els.startDateText.value = `${dd}/${mm}/${yyyy}`;
    }
    function syncFromTextToNative(){
      const d = parseDMY(els.startDateText.value); if(!d) return;
      els.startDateNative.value = toISOFromDate(d);
    }
    function recalcDays(){
      const d = parseDMY(els.startDateText.value);
      const t = new Date(els.today.value);
      if(!d){ els.autoDays.value=""; els.durationLine.textContent=""; show(); return; }
      if(d>t){ els.errStart.textContent="роЕроЯроХрпБ родрпЗродро┐ ро╡ро░рпБроЩрпНроХро╛ро▓родрпНродро┐ро▓рпН роЗро░рпБроХрпНроХроХрпНроХрпВроЯро╛родрпБ."; els.autoDays.value=""; show(); return; }
      const days = diffDays(d,t);
      els.autoDays.value = days;
      els.durationLine.textContent = `роХро╛ро▓ роЕро│ро╡рпБ: ${humanMD(days)} (${days} роиро╛ро│рпН)`;
      show();
    }
    function validate(){
      let ok = true;
      els.errAmount.textContent = "";
      els.errStart.textContent = "";
      if(!(els.amount.value && Number(els.amount.value) > 0)){ els.errAmount.textContent="роЪро░ро┐ропро╛рой родрпКроХрпИропрпИ роЙро│рпНро│ро┐роЯро╡рпБроорпН."; ok=false; }
      const d = parseDMY(els.startDateText.value);
      if(!d){ els.errStart.textContent="родрпЗродро┐ DD/MM/YYYY ро╡роЯро┐ро╡ро┐ро▓рпН роЙро│рпНро│ро┐роЯро╡рпБроорпН."; ok=false; }
      else {
        const t = new Date(els.today.value);
        if(d>t){ els.errStart.textContent="роЕроЯроХрпБ родрпЗродро┐ ро╡ро░рпБроЩрпНроХро╛ро▓родрпНродро┐ро▓рпН роЗро░рпБроХрпНроХроХрпНроХрпВроЯро╛родрпБ."; ok=false; }
      }
      return ok;
    }
    function show(){
      if(!validate()){ els.results.style.display="none"; return; }
      const P = Number(els.amount.value);
      const rate = 1.25;
      const days = Number(els.autoDays.value || 0);
      const monthly = P*(rate/100);
      const daily   = monthly/30;
      const yearly  = daily*365;
      const intDays = daily*days;
      const intMons = monthly*(days/30);
      const intYear = yearly*(days/365);
      els.outPrincipal.textContent = formatINR(P);
      els.outRate.textContent = rate + "%";
      els.outDays.textContent = days + " роиро╛ро│рпН";
      els.dyBreakdown.textContent = "роиро╛роЯрпНроХро│рпН: " + days + " роиро╛ро│рпН";
      els.moBreakdown.textContent = "рооро╛род роЕро│ро╡рпБ: " + humanMD(days);
      els.yrBreakdown.textContent = "ро╡ро░рпБроЯ роЕро│ро╡рпБ: " + humanYMD(days);
      const r = r2;
      els.dyInterest.textContent = formatINR(r(intDays));
      els.dyTotal.textContent    = formatINR(r(P + intDays));
      els.moInterest.textContent = formatINR(r(intMons));
      els.moTotal.textContent    = formatINR(r(P + intMons));
      els.yrInterest.textContent = formatINR(r(intYear));
      els.yrTotal.textContent    = formatINR(r(P + intYear));
      els.results.style.display = "block";
    }

    els.amount.addEventListener('input', show);
    els.startDateText.addEventListener('input', (e)=>{ autoFormatDMY(e.target); syncFromTextToNative(); recalcDays(); });
    els.openCalendar.addEventListener('click', ()=>{ els.startDateNative.showPicker ? els.startDateNative.showPicker() : els.startDateNative.click(); });
    els.startDateNative.addEventListener('change', ()=>{ syncFromNativeToText(); recalcDays(); });
    els.btnReset.addEventListener('click', ()=>{
      els.amount.value=""; els.startDateText.value=""; els.startDateNative.value="";
      els.autoDays.value=""; els.errAmount.textContent=""; els.errStart.textContent="";
      els.results.style.display="none"; setTodayAndMax();
    });

    window.addEventListener('load', ()=>{ setTodayAndMax(); show(); });
  </script>
</body>
</html>
